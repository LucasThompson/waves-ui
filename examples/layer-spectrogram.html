<<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Spectrogram Layer</title>

  <link rel="stylesheet" type="text/css" href="./assets/common.css" />
  <link rel="stylesheet" type="text/css" href="./assets/prism.css" />

  <script src="../waves-ui.umd.js"></script>
  <script src="./assets/prism.js"></script>
  <script src="./assets/insert-code.js"></script>
  <script src="./assets/waves-loaders.min.js"></script>
</head>
<body>

  <h1>Spectrogram Layer</h1>

  <div class="track" id="track-1"></div>
  <div class="track" id="track-2"></div>

  <script class="example" rel="track-2">
    var loader = new wavesLoaders.AudioBufferLoader();

    loader.load('./assets/prince-positivity-16.wav').then(function(buffer) {
      var $track1 = document.querySelector('#track-1');
      var $track2 = document.querySelector('#track-2');
      var width = $track1.getBoundingClientRect().width;
      var height = 200;
      var duration = buffer.duration * 2;

      var pixelsPerSecond = width / duration;

      var timeline = new wavesUI.core.Timeline(pixelsPerSecond, width);
      var track1 = new wavesUI.core.Track($track1, height);
      var track2 = new wavesUI.core.Track($track2, height);

      timeline.state = new wavesUI.states.CenteredZoomState(timeline);

      var matrixLayer = new wavesUI.helpers.SpectrogramLayer(buffer, {
        stepSize: 512,
        fftSize: 1024,
        height: height
      });

      var timeContext = new wavesUI.core.LayerTimeContext(timeline.timeContext);
      timeContext.duration = buffer.duration;
      timeContext.start = 1;

      matrixLayer.setTimeContext(timeContext);
      matrixLayer.configureShape(wavesUI.shapes.Matrix, {
        y: function(d) { return d; },
      }, {
        color: 'steelblue'
      });
      // as the matrix is an `entity` layer, we have to edit the context directly
      matrixLayer.setContextEditable(true);

      track1.add(matrixLayer);
    timeline.add(track1);

    var waveformLayer = new wavesUI.helpers.WaveformLayer(buffer, {
    height: height,
    yDomain: [-1, 1]
    });

    waveformLayer.setTimeContext(timeContext);
    waveformLayer.setContextEditable(true);
    
    track2.add(waveformLayer);
    timeline.add(track2);

      timeline.tracks.render();
      timeline.tracks.update();
    });
  </script>
</body>
</html>
