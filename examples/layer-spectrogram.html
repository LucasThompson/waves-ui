<<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Spectrogram Layer</title>

  <link rel="stylesheet" type="text/css" href="./assets/common.css" />
  <link rel="stylesheet" type="text/css" href="./assets/prism.css" />

  <script src="../waves-ui.umd.js"></script>
  <script src="./assets/prism.js"></script>
  <script src="./assets/insert-code.js"></script>
  <script src="./assets/waves-loaders.min.js"></script>
</head>
<body>

  <h1>Spectrogram Layer</h1>

  <div class="track" id="track-2"></div>

  <script class="example" rel="track-2">
    var loader = new wavesLoaders.AudioBufferLoader();

    loader.load('./assets/drum-loop.wav').then(function(buffer) {
      var $track = document.querySelector('#track-2');
      var width = $track.getBoundingClientRect().width;
      var height = 200;
      var duration = buffer.duration * 2;

      var pixelsPerSecond = width / duration;

      var timeline = new wavesUI.core.Timeline(pixelsPerSecond, width);
      var track = new wavesUI.core.Track($track, height);

      var matrixLayer = new wavesUI.core.Layer('entity', buffer.getChannelData(0), {
        height: height,
        yDomain: [-1, 1]
      });

      var timeContext = new wavesUI.core.LayerTimeContext(timeline.timeContext);
      timeContext.duration = buffer.duration;
      timeContext.start = 1;

      matrixLayer.setTimeContext(timeContext);
      matrixLayer.configureShape(wavesUI.shapes.Matrix, {
        y: function(d) { return d; },
      }, {
        color: 'steelblue'
      });
      // as the matrix is an `entity` layer, we have to edit the context directly
      matrixLayer.setContextEditable(true);

      timeline.state = new wavesUI.states.CenteredZoomState(timeline);

      track.add(matrixLayer);
      timeline.add(track);

      timeline.tracks.render();
      timeline.tracks.update();
    });
  </script>
</body>
</html>
